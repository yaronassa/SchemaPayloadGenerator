# Schema Payload Generator

[![Build Status](https://travis-ci.org/<username>/<reponame>.svg?branch=master)](https://travis-ci.org/<username>/<reponame>) 
[![Coverage Status](https://coveralls.io/repos/github/<username>/<reponame>/badge.svg?branch=master)](https://coveralls.io/github/<username>/<reponame>?branch=master)

Schema payload generator allows you to generate all* possible payload combination for objects in your schema.
You can use these payloads for unit/api tests, examples, etc.

(* Well, obviously not *ALL* possibilities, but multiple values per field, with cumulative combinations for arrays and objects)

Working with ProtoBuff? FastBuffers? XML schemas? Just convert them to JSONSchema and you're good to go

## TL;DR

**Install**

``` shell
$ npm install schema-payload-generator
```

**Generate payloads**

```javascript
import {SchemaPayloadGenerator} from 'schema-payload-generator'
const generator = new SchemaPayloadGenerator();
await generator.loadSchema(mySchemaPathOrObject);
const possibilities = await generator.generatePayloads();
```

**Test/Use**

```javascript
console.log(`TEST ALL THE THINGS!`);
for (const possibility of possibilities) {
    await myAPIClient.get(possibility.payload);
}
```

## Out-Of-The-Box usage


### Loading a schema
Using schema payload generator always starts with loading a quasi-valid schema object. It doesn't have to be a full-blown by-the-book schema (though it can be) - even fragements lik e `{type: 'boolean'}` can work.

**Please note** Like the value generation itself, the `.loadSchema` command is asynchronous and returns a `Promise`.

```javascript
import {SchemaPayloadGenerator} from 'schema-payload-generator'
const generator = new SchemaPayloadGenerator();
await generator.loadSchema({type: 'object', properties: {myBool: {type: 'boolean}}});
```

Alternatively You can send a relative path to a an external file that will be required.

```javascript
await generator.loadSchema('./pathToFile.json');
```

The schema will be parsed by [JSON Schema $Ref Parser](https://www.npmjs.com/package/json-schema-ref-parser), and can receive an [options object](https://github.com/APIDevTools/json-schema-ref-parser/blob/master/docs/options.md) that will be passed directly to the parser.

```javascript
await generator.loadSchema('./pathToFile.json', {dereference: {circular: false}});
``` 

The parser will resolve all local / remote references, $ref values, etc, so you don't need to prepare / change your schemas.

### Generating values

**Please note** Like the schema loading operations, the `generator.generatePayloads` command is asynchronous and returns a `Promise`. 

Once a schema is loaded, generating values is straightforward:

```javascript
const possibilities = await generator.generatePayloads();

/*
* possibilities is an array of IFieldPossiblePayload:
* {
*   field: JSON6Schema 	// The original schema field
*   payload: any 		// The actual generated payload to be used
*   parentPossiblePayload?: IFieldPossiblePayload // The base-payload this one extends
* }
*/
```

In case the loaded schema contains many definitions and no main object (usually the case for API specs), you'll need to pass the relevant definition key.

```javascript
const possibilities = await generator.generatePayloads('key_under_definitions_schema_node');
```

#### Default generated values

By default, the generator will generate value possibilities according to the object types (read about [more flexible customizations](#customising-value-generation) below).

The values generated by default are:

| Type | Generated Values | Remarks|
|---|---|---|
|Boolean| `[true, false]`| |
|Integer| `[min, max, between]` | Min = as set by minimum. Defaults to 1. <br/> Max = as set by maximum. Defaults to 100. <br/> Between = a random number between min and max.
|Number| `[min, max, between]` | Treated as Integer
|String| `["Value"]` | Actual value produced by [https://github.com/json-schema-faker/json-schema-faker](json-schema-faker) |
|Field w/ enum| `[enum value, enum value]` | The returned array includes all values |
|Array| `[[values], [values]]` | The values are all of the array's inner type value possibilities as well as all their [pairwise combinations](https://en.wikipedia.org/wiki/All-pairs_testing)|
|Object| `[{payload:1}, {payload:2}]` | All the possibles payload combinations according to the object's `.properties` and `.required` properties|

At the end, the value-generations is always done for a root Object type field (The schema / one of its definitions). All the "leafs" fields are flattened out to JSON payloads, and so on until an array of root-level JSON payloads is returned.

These default values can be manipulated and overriden, as explained below.

#### Limiting the combinations

## Customising value generation

## Options and extensions






